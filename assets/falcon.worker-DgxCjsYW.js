class u extends Error{constructor(e,t,i){super(e),this.name="LibOQSError",this.algorithm=t,this.operation=i,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class m extends u{constructor(e,t){const i=`Failed to initialize ${e}${t?": "+t:""}`;super(i,e,"init"),this.name="LibOQSInitError"}}class y extends u{constructor(e,t,i){const s=`${e} failed for ${t}${i?": "+i:""}`;super(s,t,e),this.name="LibOQSOperationError"}}class c extends u{constructor(e,t){super(e,t,"validation"),this.name="LibOQSValidationError"}}function h(r){return r!=null&&typeof r=="object"&&ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}async function P(){return(await import(typeof Deno<"u"?"../../../../dist/falcon-512.deno.js":"/ReactJSApp/liboqs/falcon-512.min.js")).default}const a={name:"Falcon-512",identifier:"Falcon-512",type:"sig",securityLevel:1,standardized:!1,description:"Falcon-512 lattice-based signature (NIST Level 1, 128-bit quantum security)",keySize:{publicKey:897,secretKey:1281,signature:752}};async function k(){const e=await(await P())();e._OQS_init();const t=a.identifier,i=e.lengthBytesUTF8(t),s=e._malloc(i+1);e.stringToUTF8(t,s,i+1);const n=e._OQS_SIG_new(s);if(e._free(s),!n)throw new m("Falcon-512","Failed to create SIG instance");return new b(e,n)}class b{#e;#t;#i=!1;constructor(e,t){this.#e=e,this.#t=t}generateKeyPair(){this.#s();const e=this.#e._malloc(a.keySize.publicKey),t=this.#e._malloc(a.keySize.secretKey);try{if(this.#e._OQS_SIG_keypair(this.#t,e,t)!==0)throw new y("generateKeyPair","Falcon-512","Key generation failed");const s=new Uint8Array(this.#e.HEAPU8.buffer,e,a.keySize.publicKey).slice(),n=new Uint8Array(this.#e.HEAPU8.buffer,t,a.keySize.secretKey).slice();return{publicKey:s,secretKey:n}}finally{this.#e._free(e),this.#e._free(t)}}sign(e,t){this.#s(),this.#r(t);const i=this.#e._malloc(e.length),s=this.#e._malloc(a.keySize.secretKey),n=this.#e._malloc(a.keySize.signature),o=this.#e._malloc(8);try{if(this.#e.HEAPU8.set(e,i),this.#e.HEAPU8.set(t,s),this.#e._OQS_SIG_sign(this.#t,n,o,i,e.length,s)!==0)throw new y("sign","Falcon-512","Signature generation failed");const _=this.#e.getValue(o,"i32");return new Uint8Array(this.#e.HEAPU8.buffer,n,_).slice()}finally{this.#e._free(i),this.#e._free(s),this.#e._free(n),this.#e._free(o)}}verify(e,t,i){this.#s(),this.#n(i),this.#o(t);const s=this.#e._malloc(e.length),n=this.#e._malloc(t.length),o=this.#e._malloc(a.keySize.publicKey);try{return this.#e.HEAPU8.set(e,s),this.#e.HEAPU8.set(t,n),this.#e.HEAPU8.set(i,o),this.#e._OQS_SIG_verify(this.#t,s,e.length,n,t.length,o)===0}finally{this.#e._free(s),this.#e._free(n),this.#e._free(o)}}destroy(){!this.#i&&this.#t&&(this.#e._OQS_SIG_free(this.#t),this.#t=null,this.#i=!0)}get info(){return a}#s(){if(this.#i)throw new u("Instance has been destroyed","Falcon-512")}#n(e){if(!h(e)||e.length!==a.keySize.publicKey)throw new c(`Invalid public key size: expected ${a.keySize.publicKey} bytes, got ${e.length}`,"Falcon-512")}#r(e){if(!h(e)||e.length!==a.keySize.secretKey)throw new c(`Invalid secret key size: expected ${a.keySize.secretKey} bytes, got ${e.length}`,"Falcon-512")}#o(e){if(!h(e)||e.length===0||e.length>a.keySize.signature)throw new c(`Invalid signature size: expected 1-${a.keySize.signature} bytes, got ${e.length}`,"Falcon-512")}}async function F(){return(await import(typeof Deno<"u"?"../../../../dist/falcon-1024.deno.js":"/ReactJSApp/liboqs/falcon-1024.min.js")).default}const l={name:"Falcon-1024",identifier:"Falcon-1024",type:"sig",securityLevel:5,standardized:!1,description:"Falcon-1024 lattice-based signature (NIST Level 5, 256-bit quantum security)",keySize:{publicKey:1793,secretKey:2305,signature:1462}};async function z(){const e=await(await F())();e._OQS_init();const t=l.identifier,i=e.lengthBytesUTF8(t),s=e._malloc(i+1);e.stringToUTF8(t,s,i+1);const n=e._OQS_SIG_new(s);if(e._free(s),!n)throw new m("Falcon-1024","Failed to create SIG instance");return new K(e,n)}class K{#e;#t;#i=!1;constructor(e,t){this.#e=e,this.#t=t}generateKeyPair(){this.#s();const e=this.#e._malloc(l.keySize.publicKey),t=this.#e._malloc(l.keySize.secretKey);try{if(this.#e._OQS_SIG_keypair(this.#t,e,t)!==0)throw new y("generateKeyPair","Falcon-1024","Key generation failed");const s=new Uint8Array(this.#e.HEAPU8.buffer,e,l.keySize.publicKey).slice(),n=new Uint8Array(this.#e.HEAPU8.buffer,t,l.keySize.secretKey).slice();return{publicKey:s,secretKey:n}}finally{this.#e._free(e),this.#e._free(t)}}sign(e,t){this.#s(),this.#r(t);const i=this.#e._malloc(e.length),s=this.#e._malloc(l.keySize.secretKey),n=this.#e._malloc(l.keySize.signature),o=this.#e._malloc(8);try{if(this.#e.HEAPU8.set(e,i),this.#e.HEAPU8.set(t,s),this.#e._OQS_SIG_sign(this.#t,n,o,i,e.length,s)!==0)throw new y("sign","Falcon-1024","Signature generation failed");const _=this.#e.getValue(o,"i32");return new Uint8Array(this.#e.HEAPU8.buffer,n,_).slice()}finally{this.#e._free(i),this.#e._free(s),this.#e._free(n),this.#e._free(o)}}verify(e,t,i){this.#s(),this.#n(i),this.#o(t);const s=this.#e._malloc(e.length),n=this.#e._malloc(t.length),o=this.#e._malloc(l.keySize.publicKey);try{return this.#e.HEAPU8.set(e,s),this.#e.HEAPU8.set(t,n),this.#e.HEAPU8.set(i,o),this.#e._OQS_SIG_verify(this.#t,s,e.length,n,t.length,o)===0}finally{this.#e._free(s),this.#e._free(n),this.#e._free(o)}}destroy(){!this.#i&&this.#t&&(this.#e._OQS_SIG_free(this.#t),this.#t=null,this.#i=!0)}get info(){return l}#s(){if(this.#i)throw new u("Instance has been destroyed","Falcon-1024")}#n(e){if(!h(e)||e.length!==l.keySize.publicKey)throw new c(`Invalid public key size: expected ${l.keySize.publicKey} bytes, got ${e.length}`,"Falcon-1024")}#r(e){if(!h(e)||e.length!==l.keySize.secretKey)throw new c(`Invalid secret key size: expected ${l.keySize.secretKey} bytes, got ${e.length}`,"Falcon-1024")}#o(e){if(!h(e)||e.length===0||e.length>l.keySize.signature)throw new c(`Invalid signature size: expected 1-${l.keySize.signature} bytes, got ${e.length}`,"Falcon-1024")}}let f=null,d=null;async function w(){f||(f=await Promise.resolve(k())),d||(d=await Promise.resolve(z()))}function S(r){if(r===512){if(!f)throw new Error("Falcon512 not initialized");return f}else{if(!d)throw new Error("Falcon1024 not initialized");return d}}self.onmessage=async r=>{const e=r.data;try{if(e.action==="init"){await w(),self.postMessage({id:e.id,ok:!0});return}if(await w(),e.action==="generateKeypair"){const t=S(e.level),{publicKey:i,secretKey:s}=t.generateKeyPair();self.postMessage({id:e.id,ok:!0,value:{pk:i,sk:s}});return}if(e.action==="sign"){const i=S(e.level).sign(e.msg,e.sk);self.postMessage({id:e.id,ok:!0,value:i});return}if(e.action==="verify"){const i=S(e.level).verify(e.msg,e.sig,e.pk);self.postMessage({id:e.id,ok:!0,value:i});return}throw new Error(`Unknown action: ${e.action}`)}catch(t){self.postMessage({id:e.id,ok:!1,error:String(t?.message??t)})}};
