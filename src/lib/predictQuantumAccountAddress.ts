import {
  Hex,
  Address,
  keccak256,
  encodeAbiParameters,
  parseAbiParameters,
  concatHex,
  pad,
} from "viem";

// You MUST paste in the creationCode of QuantumAccount (0x....)
// You can get it from:
//   forge inspect QuantumAccount bytecode
//   or
//   ethers.getContractFactory("QuantumAccount").bytecode
export const QUANTUM_ACCOUNT_CREATION_CODE: Hex =
  "0x60e060405234801561000f575f5ffd5b50604051613f08380380613f08833981810160405281019061003191906103e3565b8473ffffffffffffffffffffffffffffffffffffffff1660a08173ffffffffffffffffffffffffffffffffffffffff16815250508373ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff1681525050815f90816100a791906106a2565b508273ffffffffffffffffffffffffffffffffffffffff1660c08173ffffffffffffffffffffffffffffffffffffffff168152505080604190816100eb91906106a2565b5060c05173ffffffffffffffffffffffffffffffffffffffff16639b0b1f6d60416040518263ffffffff1660e01b81526004016101289190610802565b61800060405180830381865afa158015610144573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610168919061090c565b600190610400610179929190610184565b505050505050610938565b82610400600f01601090048101928215610210579160200282015f5b838211156101e057835183826101000a81548161ffff021916908361ffff16021790555092602001926002016020816001010492830192600103026101a0565b801561020e5782816101000a81549061ffff02191690556002016020816001010492830192600103026101e0565b505b50905061021d9190610221565b5090565b5b80821115610238575f815f905550600101610222565b5090565b5f604051905090565b5f5ffd5b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6102768261024d565b9050919050565b6102868161026c565b8114610290575f5ffd5b50565b5f815190506102a18161027d565b92915050565b5f5ffd5b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b6102f5826102af565b810181811067ffffffffffffffff82111715610314576103136102bf565b5b80604052505050565b5f61032661023c565b905061033282826102ec565b919050565b5f67ffffffffffffffff821115610351576103506102bf565b5b61035a826102af565b9050602081019050919050565b8281835e5f83830152505050565b5f61038761038284610337565b61031d565b9050828152602081018484840111156103a3576103a26102ab565b5b6103ae848285610367565b509392505050565b5f82601f8301126103ca576103c96102a7565b5b81516103da848260208601610375565b91505092915050565b5f5f5f5f5f60a086880312156103fc576103fb610245565b5b5f61040988828901610293565b955050602061041a88828901610293565b945050604061042b88828901610293565b935050606086015167ffffffffffffffff81111561044c5761044b610249565b5b610458888289016103b6565b925050608086015167ffffffffffffffff81111561047957610478610249565b5b610485888289016103b6565b9150509295509295909350565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f60028204905060018216806104e057607f821691505b6020821081036104f3576104f261049c565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026105557fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261051a565b61055f868361051a565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f6105a361059e61059984610577565b610580565b610577565b9050919050565b5f819050919050565b6105bc83610589565b6105d06105c8826105aa565b848454610526565b825550505050565b5f5f905090565b6105e76105d8565b6105f28184846105b3565b505050565b5b818110156106155761060a5f826105df565b6001810190506105f8565b5050565b601f82111561065a5761062b816104f9565b6106348461050b565b81016020851015610643578190505b61065761064f8561050b565b8301826105f7565b50505b505050565b5f82821c905092915050565b5f61067a5f198460080261065f565b1980831691505092915050565b5f610692838361066b565b9150826002028217905092915050565b6106ab82610492565b67ffffffffffffffff8111156106c4576106c36102bf565b5b6106ce82546104c9565b6106d9828285610619565b5f60209050601f83116001811461070a575f84156106f8578287015190505b6107028582610687565b865550610769565b601f198416610718866104f9565b5f5b8281101561073f5784890151825560018201915060208501945060208101905061071a565b8683101561075c5784890151610758601f89168261066b565b8355505b6001600288020188555050505b505050505050565b5f82825260208201905092915050565b5f815461078d816104c9565b6107978186610771565b9450600182165f81146107b157600181146107c7576107f9565b60ff1983168652811515602002860193506107f9565b6107d0856104f9565b5f5b838110156107f1578154818901526001820191506020810190506107d2565b808801955050505b50505092915050565b5f6020820190508181035f83015261081a8184610781565b905092915050565b5f67ffffffffffffffff82111561083c5761083b6102bf565b5b602082029050919050565b5f5ffd5b5f61ffff82169050919050565b6108618161084b565b811461086b575f5ffd5b50565b5f8151905061087c81610858565b92915050565b5f61089461088f84610822565b61031d565b905080602084028301858111156108ae576108ad610847565b5b835b818110156108d757806108c3888261086e565b8452602084019350506020810190506108b0565b5050509392505050565b5f82601f8301126108f5576108f46102a7565b5b610400610903848285610882565b91505092915050565b5f618000828403121561092257610921610245565b5b5f61092f848285016108e1565b91505092915050565b60805160a05160c0516135986109705f395f818161051c0152818161150201526116c401525f6109e701525f61078e01526135985ff3fe6080604052600436106100eb575f3560e01c8063acae9fee11610089578063b61d27f611610058578063b61d27f6146102ec578063b68d180914610314578063c4434c871461033e578063d087d28814610366576100ec565b8063acae9fee14610234578063af86dc171461025e578063b0d691fe14610286578063b479d2d1146102b0576100ec565b806334fcd5be116100c557806334fcd5be14610190578063473ece9e146101b857806374e66d10146101e2578063893d20e81461020a576100ec565b806312cc03d9146100ee57806319822f7c1461012a57806320be26e414610166576100ec565b5b005b3480156100f9575f5ffd5b50610114600480360381019061010f91906118d8565b610390565b604051610121919061191d565b60405180910390f35b348015610135575f5ffd5b50610150600480360381019061014b91906119bf565b6104e7565b60405161015d9190611a3a565b60405180910390f35b348015610171575f5ffd5b5061017a610519565b6040516101879190611a62565b60405180910390f35b34801561019b575f5ffd5b506101b660048036038101906101b19190611adc565b610540565b005b3480156101c3575f5ffd5b506101cc610670565b6040516101d99190611bde565b60405180910390f35b3480156101ed575f5ffd5b5061020860048036038101906102039190611d36565b610777565b005b348015610215575f5ffd5b5061021e61078b565b60405161022b9190611a62565b60405180910390f35b34801561023f575f5ffd5b506102486107b2565b6040516102559190611ddd565b60405180910390f35b348015610269575f5ffd5b50610284600480360381019061027f9190611ebd565b610842565b005b348015610291575f5ffd5b5061029a6109e4565b6040516102a79190611f84565b60405180910390f35b3480156102bb575f5ffd5b506102d660048036038101906102d191906118d8565b610a0b565b6040516102e3919061191d565b60405180910390f35b3480156102f7575f5ffd5b50610312600480360381019061030d9190611ff2565b610b60565b005b34801561031f575f5ffd5b50610328610c12565b6040516103359190611ddd565b60405180910390f35b348015610349575f5ffd5b50610364600480360381019061035f9190612063565b610ca1565b005b348015610371575f5ffd5b5061037a610f37565b6040516103879190611a3a565b60405180910390f35b5f5f60428054905090505f5f90505f5b828110156104dc578473ffffffffffffffffffffffffffffffffffffffff16604282815481106103d3576103d26120bd565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16036104cf5760428181548110610431576104306120bd565b5b905f5260205f20906002020160010160149054906101000a900460ff161561048e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161048590612144565b60405180910390fd5b6001604282815481106104a4576104a36120bd565b5b905f5260205f20906002020160010160146101000a81548160ff021916908315150217905550600191505b80806001019150506103a0565b508092505050919050565b5f6104f0610fbe565b6104fa8484611035565b905061050984602001356115cf565b610512826115d2565b9392505050565b5f7f0000000000000000000000000000000000000000000000000000000000000000905090565b610548611646565b5f8282905090505f5f90505b8181101561066a57368484838181106105705761056f6120bd565b5b9050602002810190610582919061216e565b90505f6105f7825f01602081019061059a91906118d8565b83602001358480604001906105af9190612195565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f81840152601f19601f820116905080830192505050505050505a611650565b90508061065b57600184036106135761060e611667565b61065a565b8261061d5f61167a565b6040517f5a1546750000000000000000000000000000000000000000000000000000000081526004016106519291906121f7565b60405180910390fd5b5b50508080600101915050610554565b50505050565b60605f60428054905090505f8167ffffffffffffffff81111561069657610695611c12565b5b6040519080825280602002602001820160405280156106c45781602001602082028036833780820191505090505b5090505f5b8281101561076e57604281815481106106e5576106e46120bd565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16828281518110610727576107266120bd565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505080806001019150506106c9565b50809250505090565b61077f610fbe565b610788816116b2565b50565b5f7f0000000000000000000000000000000000000000000000000000000000000000905090565b6060604180546107c190612252565b80601f01602080910402602001604051908101604052809291908181526020018280546107ed90612252565b80156108385780601f1061080f57610100808354040283529160200191610838565b820191905f5260205f20905b81548152906001019060200180831161081b57829003601f168201915b5050505050905090565b5f8373ffffffffffffffffffffffffffffffffffffffff1663a6d5fb7284846040518363ffffffff1660e01b815260040161087e929190612282565b6020604051808303815f875af115801561089a573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906108be91906122c4565b9050604260405180606001604052808673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff16815260200160011515815250908060018154018082558091505060019003905f5260205f2090600202015f909190919091505f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151816001015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010160146101000a81548160ff021916908315150217905550505050505050565b5f7f0000000000000000000000000000000000000000000000000000000000000000905090565b5f5f60428054905090505f5f90505f5b82811015610b55578473ffffffffffffffffffffffffffffffffffffffff1660428281548110610a4e57610a4d6120bd565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603610b485760428181548110610aac57610aab6120bd565b5b905f5260205f20906002020160010160149054906101000a900460ff16610b08576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610aff90612339565b60405180910390fd5b5f60428281548110610b1d57610b1c6120bd565b5b905f5260205f20906002020160010160146101000a81548160ff021916908315150217905550600191505b8080600101915050610a1b565b508092505050919050565b610b68610fbe565b5f8473ffffffffffffffffffffffffffffffffffffffff16848484604051610b91929190612385565b5f6040518083038185875af1925050503d805f8114610bcb576040519150601f19603f3d011682016040523d82523d5f602084013e610bd0565b606091505b5050905080610c0b576040517f5b54f59100000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b5050505050565b60605f8054610c2090612252565b80601f0160208091040260200160405190810160405280929190818152602001828054610c4c90612252565b8015610c975780601f10610c6e57610100808354040283529160200191610c97565b820191905f5260205f20905b815481529060010190602001808311610c7a57829003601f168201915b5050505050905090565b610ca9610fbe565b5f60428054905090505f8190505f5b82811015610db6578473ffffffffffffffffffffffffffffffffffffffff1660428281548110610ceb57610cea6120bd565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603610da95760428181548110610d4957610d486120bd565b5b905f5260205f20906002020160010160149054906101000a900460ff16610da5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d9c906123e7565b60405180910390fd5b8091505b8080600101915050610cb8565b50818110610df9576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610df090612475565b60405180910390fd5b5f60428281548110610e0e57610e0d6120bd565b5b905f5260205f2090600202015f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505f8190505f85604051602001610e5491906124c3565b6040516020818303038152906040528051906020012090508173ffffffffffffffffffffffffffffffffffffffff16639726162788836040518363ffffffff1660e01b8152600401610ea79291906124e8565b602060405180830381865afa158015610ec2573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610ee69190612539565b610f25576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f1c906125d4565b60405180910390fd5b610f2e866116b2565b50505050505050565b5f610f406109e4565b73ffffffffffffffffffffffffffffffffffffffff166335567e1a305f6040518363ffffffff1660e01b8152600401610f7a92919061264e565b602060405180830381865afa158015610f95573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610fb99190612689565b905090565b610fc66109e4565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611033576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161102a906126fe565b60405180910390fd5b565b5f5f60408460200135901c90507f74e66d10e2c4d40fcb4599cfbd9c3c4edb35c83a9877c1ca869c473178437d057bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191661109a8580606001906110959190612195565b611770565b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061113957507fa6d5fb72ff9677437bd914196124cf27031bea68fef447a6418dfae9883dd5767bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166111188580606001906111139190612195565b611770565b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b806111b857507fc4434c873493097eb2a27cffc4260407aa7ff9190f21f3e71715bc60ba97d40a7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166111978580606001906111929190612195565b611770565b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b1561123a57650ad9140ad91477ffffffffffffffffffffffffffffffffffffffffffffffff168177ffffffffffffffffffffffffffffffffffffffffffffffff1614611239576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112309061278c565b60405180910390fd5b5b7fc4434c873493097eb2a27cffc4260407aa7ff9190f21f3e71715bc60ba97d40a7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191661129285806060019061128d9190612195565b611770565b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916036114ff575f60428054905090505f5f9050365f878060e001906112d59190612195565b91509150365f8980606001906112eb9190612195565b915091505f5f6014868690501015611305575f9150611329565b85855f90601492611318939291906127b2565b90611323919061282d565b60601c91505b6024848490501015611370576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611367906128fb565b60405180910390fd5b8383600490602492611384939291906127b2565b8101906113919190612954565b90505f5b888110156114d6578273ffffffffffffffffffffffffffffffffffffffff16604282815481106113c8576113c76120bd565b5b905f5260205f2090600202015f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16148015611446575060428181548110611428576114276120bd565b5b905f5260205f20906002020160010160149054906101000a900460ff165b80156114bf57508173ffffffffffffffffffffffffffffffffffffffff1660428281548110611478576114776120bd565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b156114c957600197505b8080600101915050611395565b50866114ee57600199505050505050505050506115c9565b5f99505050505050505050506115c9565b5f7f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff1663e24436308680610100019061154d9190612195565b875f60016040518663ffffffff1660e01b8152600401611571959493929190613101565b602060405180830381865afa15801561158c573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906115b09190612539565b905080156115c2575f925050506115c9565b6001925050505b92915050565b50565b5f8114611643575f3373ffffffffffffffffffffffffffffffffffffffff16826040516115fe90613178565b5f6040518083038185875af1925050503d805f8114611638576040519150601f19603f3d011682016040523d82523d5f602084013e61163d565b606091505b50509050505b50565b61164e610fbe565b565b5f5f5f845160208601878987f19050949350505050565b6116786116735f61167a565b6117ad565b565b60603d5f8311156116925782811115611691578290505b5b604051602082018101604052818152815f602083013e8092505050919050565b80604190816116c19190613305565b507f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16639b0b1f6d826040518263ffffffff1660e01b815260040161171b9190611ddd565b61800060405180830381865afa158015611737573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061175b91906134ad565b60019061040061176c9291906117b5565b5050565b5f6004838390501015611786575f60e01b6117a5565b82825f90600492611799939291906127b2565b906117a49190613504565b5b905092915050565b805160208201fd5b82610400600f01601090048101928215611841579160200282015f5b8382111561181157835183826101000a81548161ffff021916908361ffff16021790555092602001926002016020816001010492830192600103026117d1565b801561183f5782816101000a81549061ffff0219169055600201602081600101049283019260010302611811565b505b50905061184e9190611852565b5090565b5b80821115611869575f815f905550600101611853565b5090565b5f604051905090565b5f5ffd5b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6118a78261187e565b9050919050565b6118b78161189d565b81146118c1575f5ffd5b50565b5f813590506118d2816118ae565b92915050565b5f602082840312156118ed576118ec611876565b5b5f6118fa848285016118c4565b91505092915050565b5f8115159050919050565b61191781611903565b82525050565b5f6020820190506119305f83018461190e565b92915050565b5f5ffd5b5f61012082840312156119505761194f611936565b5b81905092915050565b5f819050919050565b61196b81611959565b8114611975575f5ffd5b50565b5f8135905061198681611962565b92915050565b5f819050919050565b61199e8161198c565b81146119a8575f5ffd5b50565b5f813590506119b981611995565b92915050565b5f5f5f606084860312156119d6576119d5611876565b5b5f84013567ffffffffffffffff8111156119f3576119f261187a565b5b6119ff8682870161193a565b9350506020611a1086828701611978565b9250506040611a21868287016119ab565b9150509250925092565b611a348161198c565b82525050565b5f602082019050611a4d5f830184611a2b565b92915050565b611a5c8161189d565b82525050565b5f602082019050611a755f830184611a53565b92915050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83601f840112611a9c57611a9b611a7b565b5b8235905067ffffffffffffffff811115611ab957611ab8611a7f565b5b602083019150836020820283011115611ad557611ad4611a83565b5b9250929050565b5f5f60208385031215611af257611af1611876565b5b5f83013567ffffffffffffffff811115611b0f57611b0e61187a565b5b611b1b85828601611a87565b92509250509250929050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b611b598161189d565b82525050565b5f611b6a8383611b50565b60208301905092915050565b5f602082019050919050565b5f611b8c82611b27565b611b968185611b31565b9350611ba183611b41565b805f5b83811015611bd1578151611bb88882611b5f565b9750611bc383611b76565b925050600181019050611ba4565b5085935050505092915050565b5f6020820190508181035f830152611bf68184611b82565b905092915050565b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b611c4882611c02565b810181811067ffffffffffffffff82111715611c6757611c66611c12565b5b80604052505050565b5f611c7961186d565b9050611c858282611c3f565b919050565b5f67ffffffffffffffff821115611ca457611ca3611c12565b5b611cad82611c02565b9050602081019050919050565b828183375f83830152505050565b5f611cda611cd584611c8a565b611c70565b905082815260208101848484011115611cf657611cf5611bfe565b5b611d01848285611cba565b509392505050565b5f82601f830112611d1d57611d1c611a7b565b5b8135611d2d848260208601611cc8565b91505092915050565b5f60208284031215611d4b57611d4a611876565b5b5f82013567ffffffffffffffff811115611d6857611d6761187a565b5b611d7484828501611d09565b91505092915050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f611daf82611d7d565b611db98185611d87565b9350611dc9818560208601611d97565b611dd281611c02565b840191505092915050565b5f6020820190508181035f830152611df58184611da5565b905092915050565b5f67ffffffffffffffff821115611e1757611e16611c12565b5b602082029050602081019050919050565b5f611e3a611e3584611dfd565b611c70565b90508083825260208201905060208402830185811115611e5d57611e5c611a83565b5b835b81811015611e865780611e7288826118c4565b845260208401935050602081019050611e5f565b5050509392505050565b5f82601f830112611ea457611ea3611a7b565b5b8135611eb4848260208601611e28565b91505092915050565b5f5f5f60608486031215611ed457611ed3611876565b5b5f611ee1868287016118c4565b9350506020611ef2868287016119ab565b925050604084013567ffffffffffffffff811115611f1357611f1261187a565b5b611f1f86828701611e90565b9150509250925092565b5f819050919050565b5f611f4c611f47611f428461187e565b611f29565b61187e565b9050919050565b5f611f5d82611f32565b9050919050565b5f611f6e82611f53565b9050919050565b611f7e81611f64565b82525050565b5f602082019050611f975f830184611f75565b92915050565b5f5f83601f840112611fb257611fb1611a7b565b5b8235905067ffffffffffffffff811115611fcf57611fce611a7f565b5b602083019150836001820283011115611feb57611fea611a83565b5b9250929050565b5f5f5f5f6060858703121561200a57612009611876565b5b5f612017878288016118c4565b9450506020612028878288016119ab565b935050604085013567ffffffffffffffff8111156120495761204861187a565b5b61205587828801611f9d565b925092505092959194509250565b5f5f6040838503121561207957612078611876565b5b5f612086858286016118c4565b925050602083013567ffffffffffffffff8111156120a7576120a661187a565b5b6120b385828601611d09565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b5f82825260208201905092915050565b7f5265636f76657261626c6520616c726561647920656e61626c656400000000005f82015250565b5f61212e601b836120ea565b9150612139826120fa565b602082019050919050565b5f6020820190508181035f83015261215b81612122565b9050919050565b5f5ffd5b5f5ffd5b5f5ffd5b5f8235600160600383360303811261218957612188612162565b5b80830191505092915050565b5f5f833560016020038436030381126121b1576121b0612162565b5b80840192508235915067ffffffffffffffff8211156121d3576121d2612166565b5b6020830192506001820236038313156121ef576121ee61216a565b5b509250929050565b5f60408201905061220a5f830185611a2b565b818103602083015261221c8184611da5565b90509392505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061226957607f821691505b60208210810361227c5761227b612225565b5b50919050565b5f6040820190506122955f830185611a2b565b81810360208301526122a78184611b82565b90509392505050565b5f815190506122be816118ae565b92915050565b5f602082840312156122d9576122d8611876565b5b5f6122e6848285016122b0565b91505092915050565b7f5265636f76657261626c6520616c72656164792064697361626c6564000000005f82015250565b5f612323601c836120ea565b915061232e826122ef565b602082019050919050565b5f6020820190508181035f83015261235081612317565b9050919050565b5f81905092915050565b5f61236c8385612357565b9350612379838584611cba565b82840190509392505050565b5f612391828486612361565b91508190509392505050565b7f5265636f76657261626c65206973206e6f7420616374697665000000000000005f82015250565b5f6123d16019836120ea565b91506123dc8261239d565b602082019050919050565b5f6020820190508181035f8301526123fe816123c5565b9050919050565b7f43616c6c6572206973206e6f7420616e20616374697665207265636f766572615f8201527f626c650000000000000000000000000000000000000000000000000000000000602082015250565b5f61245f6023836120ea565b915061246a82612405565b604082019050919050565b5f6020820190508181035f83015261248c81612453565b9050919050565b5f61249d82611d7d565b6124a78185612357565b93506124b7818560208601611d97565b80840191505092915050565b5f6124ce8284612493565b915081905092915050565b6124e281611959565b82525050565b5f6040820190506124fb5f830185611a53565b61250860208301846124d9565b9392505050565b61251881611903565b8114612522575f5ffd5b50565b5f815190506125338161250f565b92915050565b5f6020828403121561254e5761254d611876565b5b5f61255b84828501612525565b91505092915050565b7f5265636f76657261626c6520686173206e6f74206d6574207468726573686f6c5f8201527f6420666f722074686973206b6579000000000000000000000000000000000000602082015250565b5f6125be602e836120ea565b91506125c982612564565b604082019050919050565b5f6020820190508181035f8301526125eb816125b2565b9050919050565b5f819050919050565b5f77ffffffffffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61263861263361262e846125f2565b611f29565b6125fb565b9050919050565b6126488161261e565b82525050565b5f6040820190506126615f830185611a53565b61266e602083018461263f565b9392505050565b5f8151905061268381611995565b92915050565b5f6020828403121561269e5761269d611876565b5b5f6126ab84828501612675565b91505092915050565b7f6163636f756e743a206e6f742066726f6d20456e747279506f696e74000000005f82015250565b5f6126e8601c836120ea565b91506126f3826126b4565b602082019050919050565b5f6020820190508181035f830152612715816126dc565b9050919050565b7f41646d696e206b657920726571756972656420666f722074686973207472616e5f8201527f73616374696f6e00000000000000000000000000000000000000000000000000602082015250565b5f6127766027836120ea565b91506127818261271c565b604082019050919050565b5f6020820190508181035f8301526127a38161276a565b9050919050565b5f5ffd5b5f5ffd5b5f5f858511156127c5576127c46127aa565b5b838611156127d6576127d56127ae565b5b6001850283019150848603905094509492505050565b5f82905092915050565b5f7fffffffffffffffffffffffffffffffffffffffff00000000000000000000000082169050919050565b5f82821b905092915050565b5f61283883836127ec565b8261284381356127f6565b925060148210156128835761287e7fffffffffffffffffffffffffffffffffffffffff00000000000000000000000083601403600802612821565b831692505b505092915050565b7f496e76616c69642063616c6c4461746120666f72207570646174655075626c695f8201527f634b65795669615265636f76657261626c650000000000000000000000000000602082015250565b5f6128e56032836120ea565b91506128f08261288b565b604082019050919050565b5f6020820190508181035f830152612912816128d9565b9050919050565b5f6129238261187e565b9050919050565b61293381612919565b811461293d575f5ffd5b50565b5f8135905061294e8161292a565b92915050565b5f6020828403121561296957612968611876565b5b5f61297684828501612940565b91505092915050565b5f61298a8385611d87565b9350612997838584611cba565b6129a083611c02565b840190509392505050565b5f819050815f5260205f209050919050565b5f81546129c981612252565b6129d38186611d87565b9450600182165f81146129ed5760018114612a0357612a35565b60ff198316865281151560200286019350612a35565b612a0c856129ab565b5f5b83811015612a2d57815481890152600182019150602081019050612a0e565b808801955050505b50505092915050565b5f6104009050919050565b5f81905092915050565b5f819050919050565b5f61ffff82169050919050565b612a7281612a5c565b82525050565b5f815f1c9050919050565b5f61ffff82169050919050565b5f612aa2612a9d83612a78565b612a83565b9050919050565b5f8160101c9050919050565b5f612ac7612ac283612aa9565b612a83565b9050919050565b5f8160201c9050919050565b5f612aec612ae783612ace565b612a83565b9050919050565b5f8160301c9050919050565b5f612b11612b0c83612af3565b612a83565b9050919050565b5f8160401c9050919050565b5f612b36612b3183612b18565b612a83565b9050919050565b5f8160501c9050919050565b5f612b5b612b5683612b3d565b612a83565b9050919050565b5f8160601c9050919050565b5f612b80612b7b83612b62565b612a83565b9050919050565b5f8160701c9050919050565b5f612ba5612ba083612b87565b612a83565b9050919050565b5f8160801c9050919050565b5f612bca612bc583612bac565b612a83565b9050919050565b5f8160901c9050919050565b5f612bef612bea83612bd1565b612a83565b9050919050565b5f8160a01c9050919050565b5f612c14612c0f83612bf6565b612a83565b9050919050565b5f8160b01c9050919050565b5f612c39612c3483612c1b565b612a83565b9050919050565b5f8160c01c9050919050565b5f612c5e612c5983612c40565b612a83565b9050919050565b5f8160d01c9050919050565b5f612c83612c7e83612c65565b612a83565b9050919050565b5f8160e01c9050919050565b5f612ca8612ca383612c8a565b612a83565b9050919050565b5f8160f01c9050919050565b5f612ccd612cc883612caf565b612a83565b9050919050565b612cdd81612a3e565b612ce78184612a49565b925082612cf383612a53565b5f600115612e9f575b83600160100382011015612e9e578154612d1e87612d1983612a90565b612a69565b602087019650612d3687612d3183612ab5565b612a69565b602087019650612d4e87612d4983612ada565b612a69565b602087019650612d6687612d6183612aff565b612a69565b602087019650612d7e87612d7983612b24565b612a69565b602087019650612d9687612d9183612b49565b612a69565b602087019650612dae87612da983612b6e565b612a69565b602087019650612dc687612dc183612b93565b612a69565b602087019650612dde87612dd983612bb8565b612a69565b602087019650612df687612df183612bdd565b612a69565b602087019650612e0e87612e0983612c02565b612a69565b602087019650612e2687612e2183612c27565b612a69565b602087019650612e3e87612e3983612c4c565b612a69565b602087019650612e5687612e5183612c71565b612a69565b602087019650612e6e87612e6983612c96565b612a69565b602087019650612e8687612e8183612cbb565b612a69565b60208701965060018301925050601081019050612cfc565b5b5f156130f95781545f15612ecc57612ebf87612eba83612a90565b612a69565b6020870196506001820191505b5f15612ef157612ee487612edf83612ab5565b612a69565b6020870196506001820191505b5f15612f1657612f0987612f0483612ada565b612a69565b6020870196506001820191505b5f15612f3b57612f2e87612f2983612aff565b612a69565b6020870196506001820191505b5f15612f6057612f5387612f4e83612b24565b612a69565b6020870196506001820191505b5f15612f8557612f7887612f7383612b49565b612a69565b6020870196506001820191505b5f15612faa57612f9d87612f9883612b6e565b612a69565b6020870196506001820191505b5f15612fcf57612fc287612fbd83612b93565b612a69565b6020870196506001820191505b5f15612ff457612fe787612fe283612bb8565b612a69565b6020870196506001820191505b5f156130195761300c8761300783612bdd565b612a69565b6020870196506001820191505b5f1561303e576130318761302c83612c02565b612a69565b6020870196506001820191505b5f15613063576130568761305183612c27565b612a69565b6020870196506001820191505b5f156130885761307b8761307683612c4c565b612a69565b6020870196506001820191505b5f156130ad576130a08761309b83612c71565b612a69565b6020870196506001820191505b5f156130d2576130c5876130c083612c96565b612a69565b6020870196506001820191505b5f156130f7576130ea876130e583612cbb565b612a69565b6020870196506001820191505b505b505050505050565b5f618060820190508181035f83015261311b81878961297f565b905061312a60208301866124d9565b818103604083015261313c81856129bd565b905061314b6060830184612cd4565b9695505050505050565b50565b5f6131635f83612357565b915061316e82613155565b5f82019050919050565b5f61318282613158565b9150819050919050565b5f6020601f8301049050919050565b5f600883026131ca7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82612821565b6131d48683612821565b95508019841693508086168417925050509392505050565b5f6132066132016131fc8461198c565b611f29565b61198c565b9050919050565b5f819050919050565b61321f836131ec565b61323361322b8261320d565b84845461319b565b825550505050565b5f5f905090565b61324a61323b565b613255818484613216565b505050565b5b818110156132785761326d5f82613242565b60018101905061325b565b5050565b601f8211156132bd5761328e816129ab565b6132978461318c565b810160208510156132a6578190505b6132ba6132b28561318c565b83018261325a565b50505b505050565b5f82821c905092915050565b5f6132dd5f19846008026132c2565b1980831691505092915050565b5f6132f583836132ce565b9150826002028217905092915050565b61330e82611d7d565b67ffffffffffffffff81111561332757613326611c12565b5b6133318254612252565b61333c82828561327c565b5f60209050601f83116001811461336d575f841561335b578287015190505b61336585826132ea565b8655506133cc565b601f19841661337b866129ab565b5f5b828110156133a25784890151825560018201915060208501945060208101905061337d565b868310156133bf57848901516133bb601f8916826132ce565b8355505b6001600288020188555050505b505050505050565b5f67ffffffffffffffff8211156133ee576133ed611c12565b5b602082029050919050565b61340281612a5c565b811461340c575f5ffd5b50565b5f8151905061341d816133f9565b92915050565b5f613435613430846133d4565b611c70565b9050806020840283018581111561344f5761344e611a83565b5b835b818110156134785780613464888261340f565b845260208401935050602081019050613451565b5050509392505050565b5f82601f83011261349657613495611a7b565b5b6104006134a4848285613423565b91505092915050565b5f61800082840312156134c3576134c2611876565b5b5f6134d084828501613482565b91505092915050565b5f7fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b5f61350f83836127ec565b8261351a81356134d9565b9250600482101561355a576135557fffffffff0000000000000000000000000000000000000000000000000000000083600403600802612821565b831692505b50509291505056fea2646970667358221220084b8e42c3137e13af07b117087782be021320823b53973d2b2219c95efaa66464736f6c634300081c0033";

/**
 * Precompute the CREATE2 address for QuantumAccount
 */
export function predictQuantumAccountAddress(params: {
  factory: Address;
  entryPoint: Address;
  falcon: Address;
  publicKeyBytes: Hex;
  salt: Hex; // 32-byte hex
}): Address {
  const {
    factory,
    entryPoint,
    falcon,
    publicKeyBytes,
    salt,
  } = params;

  //
  // 1. Encode constructor args EXACTLY as Solidity does:
  //    abi.encode(entryPoint, falcon, publicKeyBytes)
  //
  const encodedArgs = encodeAbiParameters(
    parseAbiParameters(
      "address entryPoint, address falcon, bytes publicKeyBytes"
    ),
    [entryPoint, falcon, publicKeyBytes]
  );

  //
  // 2. Build initCode = creationCode ++ encodedArgs
  //
  const initCode = concatHex([QUANTUM_ACCOUNT_CREATION_CODE, encodedArgs]);

  //
  // 3. Hash initCode
  //
  const initCodeHash = keccak256(initCode);

  //
  // 4. CREATE2 address formula:
  //
  //    keccak256( 0xff ++ factory ++ salt ++ initCodeHash )[12:]
  //

  const salt32 = pad(salt, { size: 32 });

  const data = concatHex([
    "0xff",
    factory,
    salt32,
    initCodeHash,
  ]);

  const hash = keccak256(data);

  // Take the last 20 bytes â†’ Ethereum address
  const address = ("0x" + hash.slice(26)) as Address;
  return address;
}
