import {
  Hex,
  Address,
  keccak256,
  encodeAbiParameters,
  parseAbiParameters,
  concatHex,
  pad,
} from "viem";

// You MUST paste in the creationCode of QuantumAccount (0x....)
// You can get it from:
//   forge inspect QuantumAccount bytecode
//   or
//   ethers.getContractFactory("QuantumAccount").bytecode
export const QUANTUM_ACCOUNT_CREATION_CODE: Hex =
  "0x60c060405234801561000f575f5ffd5b50604051613cac380380613cac8339818101604052810190610031919061039d565b8273ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff16815250508173ffffffffffffffffffffffffffffffffffffffff1660a08173ffffffffffffffffffffffffffffffffffffffff168152505080602090816100a89190610619565b5060a05173ffffffffffffffffffffffffffffffffffffffff16639b0b1f6d60206040518263ffffffff1660e01b81526004016100e59190610779565b61400060405180830381865afa158015610101573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906101259190610883565b5f9061020061013592919061013e565b505050506108af565b82610200600f016010900481019282156101ca579160200282015f5b8382111561019a57835183826101000a81548161ffff021916908361ffff160217905550926020019260020160208160010104928301926001030261015a565b80156101c85782816101000a81549061ffff021916905560020160208160010104928301926001030261019a565b505b5090506101d791906101db565b5090565b5b808211156101f2575f815f9055506001016101dc565b5090565b5f604051905090565b5f5ffd5b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61023082610207565b9050919050565b61024081610226565b811461024a575f5ffd5b50565b5f8151905061025b81610237565b92915050565b5f5ffd5b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b6102af82610269565b810181811067ffffffffffffffff821117156102ce576102cd610279565b5b80604052505050565b5f6102e06101f6565b90506102ec82826102a6565b919050565b5f67ffffffffffffffff82111561030b5761030a610279565b5b61031482610269565b9050602081019050919050565b8281835e5f83830152505050565b5f61034161033c846102f1565b6102d7565b90508281526020810184848401111561035d5761035c610265565b5b610368848285610321565b509392505050565b5f82601f83011261038457610383610261565b5b815161039484826020860161032f565b91505092915050565b5f5f5f606084860312156103b4576103b36101ff565b5b5f6103c18682870161024d565b93505060206103d28682870161024d565b925050604084015167ffffffffffffffff8111156103f3576103f2610203565b5b6103ff86828701610370565b9150509250925092565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061045757607f821691505b60208210810361046a57610469610413565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026104cc7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610491565b6104d68683610491565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f61051a610515610510846104ee565b6104f7565b6104ee565b9050919050565b5f819050919050565b61053383610500565b61054761053f82610521565b84845461049d565b825550505050565b5f5f905090565b61055e61054f565b61056981848461052a565b505050565b5b8181101561058c576105815f82610556565b60018101905061056f565b5050565b601f8211156105d1576105a281610470565b6105ab84610482565b810160208510156105ba578190505b6105ce6105c685610482565b83018261056e565b50505b505050565b5f82821c905092915050565b5f6105f15f19846008026105d6565b1980831691505092915050565b5f61060983836105e2565b9150826002028217905092915050565b61062282610409565b67ffffffffffffffff81111561063b5761063a610279565b5b6106458254610440565b610650828285610590565b5f60209050601f831160018114610681575f841561066f578287015190505b61067985826105fe565b8655506106e0565b601f19841661068f86610470565b5f5b828110156106b657848901518255600182019150602085019450602081019050610691565b868310156106d357848901516106cf601f8916826105e2565b8355505b6001600288020188555050505b505050505050565b5f82825260208201905092915050565b5f815461070481610440565b61070e81866106e8565b9450600182165f8114610728576001811461073e57610770565b60ff198316865281151560200286019350610770565b61074785610470565b5f5b8381101561076857815481890152600182019150602081019050610749565b808801955050505b50505092915050565b5f6020820190508181035f83015261079181846106f8565b905092915050565b5f67ffffffffffffffff8211156107b3576107b2610279565b5b602082029050919050565b5f5ffd5b5f61ffff82169050919050565b6107d8816107c2565b81146107e2575f5ffd5b50565b5f815190506107f3816107cf565b92915050565b5f61080b61080684610799565b6102d7565b90508060208402830185811115610825576108246107be565b5b835b8181101561084e578061083a88826107e5565b845260208401935050602081019050610827565b5050509392505050565b5f82601f83011261086c5761086b610261565b5b61020061087a8482856107f9565b91505092915050565b5f6140008284031215610899576108986101ff565b5b5f6108a684828501610858565b91505092915050565b60805160a0516133ce6108de5f395f81816104a2015281816113d2015261159101525f61094601526133ce5ff3fe6080604052600436106100c5575f3560e01c8063acae9fee1161007e578063b479d2d111610058578063b479d2d114610260578063b61d27f61461029c578063c4434c87146102c4578063d087d288146102ec576100c6565b8063acae9fee146101e4578063af86dc171461020e578063b0d691fe14610236576100c6565b806312cc03d9146100c857806319822f7c1461010457806320be26e41461014057806334fcd5be1461016a578063473ece9e1461019257806374e66d10146101bc576100c6565b5b005b3480156100d3575f5ffd5b506100ee60048036038101906100e991906117a4565b610316565b6040516100fb91906117e9565b60405180910390f35b34801561010f575f5ffd5b5061012a6004803603810190610125919061188b565b61046d565b6040516101379190611906565b60405180910390f35b34801561014b575f5ffd5b5061015461049f565b604051610161919061192e565b60405180910390f35b348015610175575f5ffd5b50610190600480360381019061018b91906119a8565b6104c6565b005b34801561019d575f5ffd5b506101a66105f6565b6040516101b39190611aaa565b60405180910390f35b3480156101c7575f5ffd5b506101e260048036038101906101dd9190611c02565b6106fd565b005b3480156101ef575f5ffd5b506101f8610711565b6040516102059190611ca9565b60405180910390f35b348015610219575f5ffd5b50610234600480360381019061022f9190611d89565b6107a1565b005b348015610241575f5ffd5b5061024a610943565b6040516102579190611e50565b60405180910390f35b34801561026b575f5ffd5b50610286600480360381019061028191906117a4565b61096a565b60405161029391906117e9565b60405180910390f35b3480156102a7575f5ffd5b506102c260048036038101906102bd9190611ebe565b610abf565b005b3480156102cf575f5ffd5b506102ea60048036038101906102e59190611f2f565b610b71565b005b3480156102f7575f5ffd5b50610300610e07565b60405161030d9190611906565b60405180910390f35b5f5f60218054905090505f5f90505f5b82811015610462578473ffffffffffffffffffffffffffffffffffffffff166021828154811061035957610358611f89565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff160361045557602181815481106103b7576103b6611f89565b5b905f5260205f20906002020160010160149054906101000a900460ff1615610414576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161040b90612010565b60405180910390fd5b60016021828154811061042a57610429611f89565b5b905f5260205f20906002020160010160146101000a81548160ff021916908315150217905550600191505b8080600101915050610326565b508092505050919050565b5f610476610e8e565b6104808484610f05565b905061048f846020013561149c565b6104988261149f565b9392505050565b5f7f0000000000000000000000000000000000000000000000000000000000000000905090565b6104ce611513565b5f8282905090505f5f90505b818110156105f057368484838181106104f6576104f5611f89565b5b9050602002810190610508919061203a565b90505f61057d825f01602081019061052091906117a4565b83602001358480604001906105359190612061565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f81840152601f19601f820116905080830192505050505050505a61151d565b9050806105e1576001840361059957610594611534565b6105e0565b826105a35f611547565b6040517f5a1546750000000000000000000000000000000000000000000000000000000081526004016105d79291906120c3565b60405180910390fd5b5b505080806001019150506104da565b50505050565b60605f60218054905090505f8167ffffffffffffffff81111561061c5761061b611ade565b5b60405190808252806020026020018201604052801561064a5781602001602082028036833780820191505090505b5090505f5b828110156106f4576021818154811061066b5761066a611f89565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff168282815181106106ad576106ac611f89565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050808060010191505061064f565b50809250505090565b610705610e8e565b61070e8161157f565b50565b6060602080546107209061211e565b80601f016020809104026020016040519081016040528092919081815260200182805461074c9061211e565b80156107975780601f1061076e57610100808354040283529160200191610797565b820191905f5260205f20905b81548152906001019060200180831161077a57829003601f168201915b5050505050905090565b5f8373ffffffffffffffffffffffffffffffffffffffff1663a6d5fb7284846040518363ffffffff1660e01b81526004016107dd92919061214e565b6020604051808303815f875af11580156107f9573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061081d9190612190565b9050602160405180606001604052808673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff16815260200160011515815250908060018154018082558091505060019003905f5260205f2090600202015f909190919091505f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151816001015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010160146101000a81548160ff021916908315150217905550505050505050565b5f7f0000000000000000000000000000000000000000000000000000000000000000905090565b5f5f60218054905090505f5f90505f5b82811015610ab4578473ffffffffffffffffffffffffffffffffffffffff16602182815481106109ad576109ac611f89565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603610aa75760218181548110610a0b57610a0a611f89565b5b905f5260205f20906002020160010160149054906101000a900460ff16610a67576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a5e90612205565b60405180910390fd5b5f60218281548110610a7c57610a7b611f89565b5b905f5260205f20906002020160010160146101000a81548160ff021916908315150217905550600191505b808060010191505061097a565b508092505050919050565b610ac7610e8e565b5f8473ffffffffffffffffffffffffffffffffffffffff16848484604051610af0929190612251565b5f6040518083038185875af1925050503d805f8114610b2a576040519150601f19603f3d011682016040523d82523d5f602084013e610b2f565b606091505b5050905080610b6a576040517f5b54f59100000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b5050505050565b610b79610e8e565b5f60218054905090505f8190505f5b82811015610c86578473ffffffffffffffffffffffffffffffffffffffff1660218281548110610bbb57610bba611f89565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603610c795760218181548110610c1957610c18611f89565b5b905f5260205f20906002020160010160149054906101000a900460ff16610c75576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c6c906122b3565b60405180910390fd5b8091505b8080600101915050610b88565b50818110610cc9576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cc090612341565b60405180910390fd5b5f60218281548110610cde57610cdd611f89565b5b905f5260205f2090600202015f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505f8190505f85604051602001610d24919061238f565b6040516020818303038152906040528051906020012090508173ffffffffffffffffffffffffffffffffffffffff16639726162788836040518363ffffffff1660e01b8152600401610d779291906123b4565b602060405180830381865afa158015610d92573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610db69190612405565b610df5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610dec906124a0565b60405180910390fd5b610dfe8661157f565b50505050505050565b5f610e10610943565b73ffffffffffffffffffffffffffffffffffffffff166335567e1a305f6040518363ffffffff1660e01b8152600401610e4a92919061251a565b602060405180830381865afa158015610e65573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610e899190612555565b905090565b610e96610943565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610f03576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610efa906125ca565b60405180910390fd5b565b5f5f60408460200135901c90507f74e66d10e2c4d40fcb4599cfbd9c3c4edb35c83a9877c1ca869c473178437d057bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916610f6a858060600190610f659190612061565b61163c565b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061100957507fa6d5fb72ff9677437bd914196124cf27031bea68fef447a6418dfae9883dd5767bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916610fe8858060600190610fe39190612061565b61163c565b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b8061108857507fc4434c873493097eb2a27cffc4260407aa7ff9190f21f3e71715bc60ba97d40a7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166110678580606001906110629190612061565b61163c565b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b1561110a57650ad9140ad91477ffffffffffffffffffffffffffffffffffffffffffffffff168177ffffffffffffffffffffffffffffffffffffffffffffffff1614611109576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161110090612658565b60405180910390fd5b5b7fc4434c873493097eb2a27cffc4260407aa7ff9190f21f3e71715bc60ba97d40a7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191661116285806060019061115d9190612061565b61163c565b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916036113cf575f60218054905090505f5f9050365f878060e001906111a59190612061565b91509150365f8980606001906111bb9190612061565b915091505f5f60148686905010156111d5575f91506111f9565b85855f906014926111e89392919061267e565b906111f391906126f9565b60601c91505b6024848490501015611240576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611237906127c7565b60405180910390fd5b83836004906024926112549392919061267e565b8101906112619190612820565b90505f5b888110156113a6578273ffffffffffffffffffffffffffffffffffffffff166021828154811061129857611297611f89565b5b905f5260205f2090600202015f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161480156113165750602181815481106112f8576112f7611f89565b5b905f5260205f20906002020160010160149054906101000a900460ff165b801561138f57508173ffffffffffffffffffffffffffffffffffffffff166021828154811061134857611347611f89565b5b905f5260205f2090600202016001015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b1561139957600197505b8080600101915050611265565b50866113be5760019950505050505050505050611496565b5f9950505050505050505050611496565b5f7f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff1663fcb9b89b8680610100019061141d9190612061565b875f6040518563ffffffff1660e01b815260040161143e9493929190612f3a565b602060405180830381865afa158015611459573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061147d9190612405565b9050801561148f575f92505050611496565b6001925050505b92915050565b50565b5f8114611510575f3373ffffffffffffffffffffffffffffffffffffffff16826040516114cb90612f9c565b5f6040518083038185875af1925050503d805f8114611505576040519150601f19603f3d011682016040523d82523d5f602084013e61150a565b606091505b50509050505b50565b61151b610e8e565b565b5f5f5f845160208601878987f19050949350505050565b6115456115405f611547565b611679565b565b60603d5f83111561155f578281111561155e578290505b5b604051602082018101604052818152815f602083013e8092505050919050565b806020908161158e919061313b565b507f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16639b0b1f6d826040518263ffffffff1660e01b81526004016115e89190611ca9565b61400060405180830381865afa158015611604573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061162891906132e3565b5f90610200611638929190611681565b5050565b5f6004838390501015611652575f60e01b611671565b82825f906004926116659392919061267e565b90611670919061333a565b5b905092915050565b805160208201fd5b82610200600f0160109004810192821561170d579160200282015f5b838211156116dd57835183826101000a81548161ffff021916908361ffff160217905550926020019260020160208160010104928301926001030261169d565b801561170b5782816101000a81549061ffff02191690556002016020816001010492830192600103026116dd565b505b50905061171a919061171e565b5090565b5b80821115611735575f815f90555060010161171f565b5090565b5f604051905090565b5f5ffd5b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6117738261174a565b9050919050565b61178381611769565b811461178d575f5ffd5b50565b5f8135905061179e8161177a565b92915050565b5f602082840312156117b9576117b8611742565b5b5f6117c684828501611790565b91505092915050565b5f8115159050919050565b6117e3816117cf565b82525050565b5f6020820190506117fc5f8301846117da565b92915050565b5f5ffd5b5f610120828403121561181c5761181b611802565b5b81905092915050565b5f819050919050565b61183781611825565b8114611841575f5ffd5b50565b5f813590506118528161182e565b92915050565b5f819050919050565b61186a81611858565b8114611874575f5ffd5b50565b5f8135905061188581611861565b92915050565b5f5f5f606084860312156118a2576118a1611742565b5b5f84013567ffffffffffffffff8111156118bf576118be611746565b5b6118cb86828701611806565b93505060206118dc86828701611844565b92505060406118ed86828701611877565b9150509250925092565b61190081611858565b82525050565b5f6020820190506119195f8301846118f7565b92915050565b61192881611769565b82525050565b5f6020820190506119415f83018461191f565b92915050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83601f84011261196857611967611947565b5b8235905067ffffffffffffffff8111156119855761198461194b565b5b6020830191508360208202830111156119a1576119a061194f565b5b9250929050565b5f5f602083850312156119be576119bd611742565b5b5f83013567ffffffffffffffff8111156119db576119da611746565b5b6119e785828601611953565b92509250509250929050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b611a2581611769565b82525050565b5f611a368383611a1c565b60208301905092915050565b5f602082019050919050565b5f611a58826119f3565b611a6281856119fd565b9350611a6d83611a0d565b805f5b83811015611a9d578151611a848882611a2b565b9750611a8f83611a42565b925050600181019050611a70565b5085935050505092915050565b5f6020820190508181035f830152611ac28184611a4e565b905092915050565b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b611b1482611ace565b810181811067ffffffffffffffff82111715611b3357611b32611ade565b5b80604052505050565b5f611b45611739565b9050611b518282611b0b565b919050565b5f67ffffffffffffffff821115611b7057611b6f611ade565b5b611b7982611ace565b9050602081019050919050565b828183375f83830152505050565b5f611ba6611ba184611b56565b611b3c565b905082815260208101848484011115611bc257611bc1611aca565b5b611bcd848285611b86565b509392505050565b5f82601f830112611be957611be8611947565b5b8135611bf9848260208601611b94565b91505092915050565b5f60208284031215611c1757611c16611742565b5b5f82013567ffffffffffffffff811115611c3457611c33611746565b5b611c4084828501611bd5565b91505092915050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f611c7b82611c49565b611c858185611c53565b9350611c95818560208601611c63565b611c9e81611ace565b840191505092915050565b5f6020820190508181035f830152611cc18184611c71565b905092915050565b5f67ffffffffffffffff821115611ce357611ce2611ade565b5b602082029050602081019050919050565b5f611d06611d0184611cc9565b611b3c565b90508083825260208201905060208402830185811115611d2957611d2861194f565b5b835b81811015611d525780611d3e8882611790565b845260208401935050602081019050611d2b565b5050509392505050565b5f82601f830112611d7057611d6f611947565b5b8135611d80848260208601611cf4565b91505092915050565b5f5f5f60608486031215611da057611d9f611742565b5b5f611dad86828701611790565b9350506020611dbe86828701611877565b925050604084013567ffffffffffffffff811115611ddf57611dde611746565b5b611deb86828701611d5c565b9150509250925092565b5f819050919050565b5f611e18611e13611e0e8461174a565b611df5565b61174a565b9050919050565b5f611e2982611dfe565b9050919050565b5f611e3a82611e1f565b9050919050565b611e4a81611e30565b82525050565b5f602082019050611e635f830184611e41565b92915050565b5f5f83601f840112611e7e57611e7d611947565b5b8235905067ffffffffffffffff811115611e9b57611e9a61194b565b5b602083019150836001820283011115611eb757611eb661194f565b5b9250929050565b5f5f5f5f60608587031215611ed657611ed5611742565b5b5f611ee387828801611790565b9450506020611ef487828801611877565b935050604085013567ffffffffffffffff811115611f1557611f14611746565b5b611f2187828801611e69565b925092505092959194509250565b5f5f60408385031215611f4557611f44611742565b5b5f611f5285828601611790565b925050602083013567ffffffffffffffff811115611f7357611f72611746565b5b611f7f85828601611bd5565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b5f82825260208201905092915050565b7f5265636f76657261626c6520616c726561647920656e61626c656400000000005f82015250565b5f611ffa601b83611fb6565b915061200582611fc6565b602082019050919050565b5f6020820190508181035f83015261202781611fee565b9050919050565b5f5ffd5b5f5ffd5b5f5ffd5b5f823560016060038336030381126120555761205461202e565b5b80830191505092915050565b5f5f8335600160200384360303811261207d5761207c61202e565b5b80840192508235915067ffffffffffffffff82111561209f5761209e612032565b5b6020830192506001820236038313156120bb576120ba612036565b5b509250929050565b5f6040820190506120d65f8301856118f7565b81810360208301526120e88184611c71565b90509392505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061213557607f821691505b602082108103612148576121476120f1565b5b50919050565b5f6040820190506121615f8301856118f7565b81810360208301526121738184611a4e565b90509392505050565b5f8151905061218a8161177a565b92915050565b5f602082840312156121a5576121a4611742565b5b5f6121b28482850161217c565b91505092915050565b7f5265636f76657261626c6520616c72656164792064697361626c6564000000005f82015250565b5f6121ef601c83611fb6565b91506121fa826121bb565b602082019050919050565b5f6020820190508181035f83015261221c816121e3565b9050919050565b5f81905092915050565b5f6122388385612223565b9350612245838584611b86565b82840190509392505050565b5f61225d82848661222d565b91508190509392505050565b7f5265636f76657261626c65206973206e6f7420616374697665000000000000005f82015250565b5f61229d601983611fb6565b91506122a882612269565b602082019050919050565b5f6020820190508181035f8301526122ca81612291565b9050919050565b7f43616c6c6572206973206e6f7420616e20616374697665207265636f766572615f8201527f626c650000000000000000000000000000000000000000000000000000000000602082015250565b5f61232b602383611fb6565b9150612336826122d1565b604082019050919050565b5f6020820190508181035f8301526123588161231f565b9050919050565b5f61236982611c49565b6123738185612223565b9350612383818560208601611c63565b80840191505092915050565b5f61239a828461235f565b915081905092915050565b6123ae81611825565b82525050565b5f6040820190506123c75f83018561191f565b6123d460208301846123a5565b9392505050565b6123e4816117cf565b81146123ee575f5ffd5b50565b5f815190506123ff816123db565b92915050565b5f6020828403121561241a57612419611742565b5b5f612427848285016123f1565b91505092915050565b7f5265636f76657261626c6520686173206e6f74206d6574207468726573686f6c5f8201527f6420666f722074686973206b6579000000000000000000000000000000000000602082015250565b5f61248a602e83611fb6565b915061249582612430565b604082019050919050565b5f6020820190508181035f8301526124b78161247e565b9050919050565b5f819050919050565b5f77ffffffffffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6125046124ff6124fa846124be565b611df5565b6124c7565b9050919050565b612514816124ea565b82525050565b5f60408201905061252d5f83018561191f565b61253a602083018461250b565b9392505050565b5f8151905061254f81611861565b92915050565b5f6020828403121561256a57612569611742565b5b5f61257784828501612541565b91505092915050565b7f6163636f756e743a206e6f742066726f6d20456e747279506f696e74000000005f82015250565b5f6125b4601c83611fb6565b91506125bf82612580565b602082019050919050565b5f6020820190508181035f8301526125e1816125a8565b9050919050565b7f41646d696e206b657920726571756972656420666f722074686973207472616e5f8201527f73616374696f6e00000000000000000000000000000000000000000000000000602082015250565b5f612642602783611fb6565b915061264d826125e8565b604082019050919050565b5f6020820190508181035f83015261266f81612636565b9050919050565b5f5ffd5b5f5ffd5b5f5f8585111561269157612690612676565b5b838611156126a2576126a161267a565b5b6001850283019150848603905094509492505050565b5f82905092915050565b5f7fffffffffffffffffffffffffffffffffffffffff00000000000000000000000082169050919050565b5f82821b905092915050565b5f61270483836126b8565b8261270f81356126c2565b9250601482101561274f5761274a7fffffffffffffffffffffffffffffffffffffffff000000000000000000000000836014036008026126ed565b831692505b505092915050565b7f496e76616c69642063616c6c4461746120666f72207570646174655075626c695f8201527f634b65795669615265636f76657261626c650000000000000000000000000000602082015250565b5f6127b1603283611fb6565b91506127bc82612757565b604082019050919050565b5f6020820190508181035f8301526127de816127a5565b9050919050565b5f6127ef8261174a565b9050919050565b6127ff816127e5565b8114612809575f5ffd5b50565b5f8135905061281a816127f6565b92915050565b5f6020828403121561283557612834611742565b5b5f6128428482850161280c565b91505092915050565b5f6128568385611c53565b9350612863838584611b86565b61286c83611ace565b840190509392505050565b5f6102009050919050565b5f81905092915050565b5f819050919050565b5f61ffff82169050919050565b6128ab81612895565b82525050565b5f815f1c9050919050565b5f61ffff82169050919050565b5f6128db6128d6836128b1565b6128bc565b9050919050565b5f8160101c9050919050565b5f6129006128fb836128e2565b6128bc565b9050919050565b5f8160201c9050919050565b5f61292561292083612907565b6128bc565b9050919050565b5f8160301c9050919050565b5f61294a6129458361292c565b6128bc565b9050919050565b5f8160401c9050919050565b5f61296f61296a83612951565b6128bc565b9050919050565b5f8160501c9050919050565b5f61299461298f83612976565b6128bc565b9050919050565b5f8160601c9050919050565b5f6129b96129b48361299b565b6128bc565b9050919050565b5f8160701c9050919050565b5f6129de6129d9836129c0565b6128bc565b9050919050565b5f8160801c9050919050565b5f612a036129fe836129e5565b6128bc565b9050919050565b5f8160901c9050919050565b5f612a28612a2383612a0a565b6128bc565b9050919050565b5f8160a01c9050919050565b5f612a4d612a4883612a2f565b6128bc565b9050919050565b5f8160b01c9050919050565b5f612a72612a6d83612a54565b6128bc565b9050919050565b5f8160c01c9050919050565b5f612a97612a9283612a79565b6128bc565b9050919050565b5f8160d01c9050919050565b5f612abc612ab783612a9e565b6128bc565b9050919050565b5f8160e01c9050919050565b5f612ae1612adc83612ac3565b6128bc565b9050919050565b5f8160f01c9050919050565b5f612b06612b0183612ae8565b6128bc565b9050919050565b612b1681612877565b612b208184612882565b925082612b2c8361288c565b5f600115612cd8575b83600160100382011015612cd7578154612b5787612b52836128c9565b6128a2565b602087019650612b6f87612b6a836128ee565b6128a2565b602087019650612b8787612b8283612913565b6128a2565b602087019650612b9f87612b9a83612938565b6128a2565b602087019650612bb787612bb28361295d565b6128a2565b602087019650612bcf87612bca83612982565b6128a2565b602087019650612be787612be2836129a7565b6128a2565b602087019650612bff87612bfa836129cc565b6128a2565b602087019650612c1787612c12836129f1565b6128a2565b602087019650612c2f87612c2a83612a16565b6128a2565b602087019650612c4787612c4283612a3b565b6128a2565b602087019650612c5f87612c5a83612a60565b6128a2565b602087019650612c7787612c7283612a85565b6128a2565b602087019650612c8f87612c8a83612aaa565b6128a2565b602087019650612ca787612ca283612acf565b6128a2565b602087019650612cbf87612cba83612af4565b6128a2565b60208701965060018301925050601081019050612b35565b5b5f15612f325781545f15612d0557612cf887612cf3836128c9565b6128a2565b6020870196506001820191505b5f15612d2a57612d1d87612d18836128ee565b6128a2565b6020870196506001820191505b5f15612d4f57612d4287612d3d83612913565b6128a2565b6020870196506001820191505b5f15612d7457612d6787612d6283612938565b6128a2565b6020870196506001820191505b5f15612d9957612d8c87612d878361295d565b6128a2565b6020870196506001820191505b5f15612dbe57612db187612dac83612982565b6128a2565b6020870196506001820191505b5f15612de357612dd687612dd1836129a7565b6128a2565b6020870196506001820191505b5f15612e0857612dfb87612df6836129cc565b6128a2565b6020870196506001820191505b5f15612e2d57612e2087612e1b836129f1565b6128a2565b6020870196506001820191505b5f15612e5257612e4587612e4083612a16565b6128a2565b6020870196506001820191505b5f15612e7757612e6a87612e6583612a3b565b6128a2565b6020870196506001820191505b5f15612e9c57612e8f87612e8a83612a60565b6128a2565b6020870196506001820191505b5f15612ec157612eb487612eaf83612a85565b6128a2565b6020870196506001820191505b5f15612ee657612ed987612ed483612aaa565b6128a2565b6020870196506001820191505b5f15612f0b57612efe87612ef983612acf565b6128a2565b6020870196506001820191505b5f15612f3057612f2387612f1e83612af4565b6128a2565b6020870196506001820191505b505b505050505050565b5f614040820190508181035f830152612f5481868861284b565b9050612f6360208301856123a5565b612f706040830184612b0d565b95945050505050565b50565b5f612f875f83612223565b9150612f9282612f79565b5f82019050919050565b5f612fa682612f7c565b9150819050919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f600883026130007fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826126ed565b61300a86836126ed565b95508019841693508086168417925050509392505050565b5f61303c61303761303284611858565b611df5565b611858565b9050919050565b5f819050919050565b61305583613022565b61306961306182613043565b848454612fd1565b825550505050565b5f5f905090565b613080613071565b61308b81848461304c565b505050565b5b818110156130ae576130a35f82613078565b600181019050613091565b5050565b601f8211156130f3576130c481612fb0565b6130cd84612fc2565b810160208510156130dc578190505b6130f06130e885612fc2565b830182613090565b50505b505050565b5f82821c905092915050565b5f6131135f19846008026130f8565b1980831691505092915050565b5f61312b8383613104565b9150826002028217905092915050565b61314482611c49565b67ffffffffffffffff81111561315d5761315c611ade565b5b613167825461211e565b6131728282856130b2565b5f60209050601f8311600181146131a3575f8415613191578287015190505b61319b8582613120565b865550613202565b601f1984166131b186612fb0565b5f5b828110156131d8578489015182556001820191506020850194506020810190506131b3565b868310156131f557848901516131f1601f891682613104565b8355505b6001600288020188555050505b505050505050565b5f67ffffffffffffffff82111561322457613223611ade565b5b602082029050919050565b61323881612895565b8114613242575f5ffd5b50565b5f815190506132538161322f565b92915050565b5f61326b6132668461320a565b611b3c565b905080602084028301858111156132855761328461194f565b5b835b818110156132ae578061329a8882613245565b845260208401935050602081019050613287565b5050509392505050565b5f82601f8301126132cc576132cb611947565b5b6102006132da848285613259565b91505092915050565b5f61400082840312156132f9576132f8611742565b5b5f613306848285016132b8565b91505092915050565b5f7fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b5f61334583836126b8565b82613350813561330f565b925060048210156133905761338b7fffffffff00000000000000000000000000000000000000000000000000000000836004036008026126ed565b831692505b50509291505056fea26469706673582212201a5df0bf5b2c892d913b6614e0d4eb6185b8154a8ca1a923ced97635470e211464736f6c634300081c0033";

/**
 * Precompute the CREATE2 address for QuantumAccount
 */
export function predictQuantumAccountAddress(params: {
  factory: Address;
  entryPoint: Address;
  falcon: Address;
  publicKeyBytes: Hex;
  salt: Hex; // 32-byte hex
}): Address {
  const {
    factory,
    entryPoint,
    falcon,
    publicKeyBytes,
    salt,
  } = params;

  //
  // 1. Encode constructor args EXACTLY as Solidity does:
  //    abi.encode(entryPoint, falcon, publicKeyBytes)
  //
  const encodedArgs = encodeAbiParameters(
    parseAbiParameters(
      "address entryPoint, address falcon, bytes publicKeyBytes"
    ),
    [entryPoint, falcon, publicKeyBytes]
  );

  //
  // 2. Build initCode = creationCode ++ encodedArgs
  //
  const initCode = concatHex([QUANTUM_ACCOUNT_CREATION_CODE, encodedArgs]);

  //
  // 3. Hash initCode
  //
  const initCodeHash = keccak256(initCode);

  //
  // 4. CREATE2 address formula:
  //
  //    keccak256( 0xff ++ factory ++ salt ++ initCodeHash )[12:]
  //

  const salt32 = pad(salt, { size: 32 });

  const data = concatHex([
    "0xff",
    factory,
    salt32,
    initCodeHash,
  ]);

  const hash = keccak256(data);

  // Take the last 20 bytes â†’ Ethereum address
  const address = ("0x" + hash.slice(26)) as Address;
  return address;
}
